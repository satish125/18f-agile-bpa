<div class="container connect-stores" ng-controller="StoresPartialCtrl">
	<div class="row">
		<h1 class="col-md-8 col-sm-6">Connect Stores</h1>
		<form class="col-md-4 col-sm-6 col-xs-12">
			<div class="input-group search-group">
				<span class="input-group-addon" id="basic-addon2"><i class="fa fa-search"></i></span>
				<input type="search" class="form-control empty" id="storeSearch" ng-model="storeSearch.name" placeholder="search for store">
			</div>
		</form>
	</div>
	<div ng-repeat="error in errors track by $index" class="clearfix">
	   <div class="alert alert-danger alert-dismissible" role="alert">
		 <button type="button" ng-click="errors.splice($index,1)" class="close" data-dismiss="alert" aria-label="Close"><span class="fa fa-close" aria-hidden="true"></span></button>
		 <ul class="fa-ul pre"><li><span class="fa-li fa fa-exclamation-triangle" aria-hidden="true"></span><span class="sr-only">Error: </span>{{error}}</li></ul>
	   </div>
	</div>

	<div>
		<ul class="media-list">
			<li class="media card" ng-repeat="store in getStores() | filter:storeSearch">
				<div class="media-left">
					<div class="store-logo-container">
						<img class="media-object" ng-src="{{store.image_link}}" alt="{{store.name}}" title="{{store.name}}">
					</div>
				</div>
				<div class="media-body">
					<form name="connectForm" class="form-inline" ng-submit="doStoreConnect(store)" autocomplete="off">
						<span class="pull-left">
							<span class="h4" ng-show="store.isConnected()">
								CONNECTED
								<span class="fa fa-check text-success" aria-hidden="true"></span>
							</span>
							<span class="h4" ng-show="store.isConnected()">
								READY
								<span class="fa fa-check text-success" aria-hidden="true"></span>
							</span>
							<div class="form-group form-control-wrapper floating-label-wrapper" ng-show="!store.isConnected() && store.userStore().status() !== 'Connecting'">
								<input style="display:none" type="text">
								<input id="username{{store.id}}" name="username{{store.id}}" type="text" class="form-control empty" ng-model="store.username" required autocomplete="off">
								<label for="username{{store.id}}" class="floating-label">user</label>
								<span class="material-input"></span>
							</div>
							<div class="form-group form-control-wrapper floating-label-wrapper" ng-show="!store.isConnected() && store.userStore().status() !== 'Connecting'">
								<input style="display:none" type="password">
								<input id="password{{store.id}}" name="password{{store.id}}" type="password" ng-model="store.password" class="form-control empty" required autocomplete="off">
								<label for="password{{store.id}}" class="floating-label">password</label>
								<span class="material-input"></span>
							</div>
						</span>
						<span class="pull-left top-half-gutter">
							<button type="submit" class="btn btn-default btn-flat btn-tight" ng-disabled="store.isWorking() || (store.userStore().credentials_status && store.userStore().credentials_status !== 'Invalid')" ng-show="!store.isConnected()">
								<span class="fa fa-link fa-rotate-90" ng-class="store.isConnecting?'fa-spin':''" aria-hidden="true"></span> Connect
							</button>
							<button type="button" class="btn btn-default btn-flat btn-tight" ng-show="store.hasConnectionAttempt()" ng-disabled="store.isWorking() || store.userStore().status() === 'Connecting'" ng-click="doStoreDisconnect(store)">
								<span class="fa fa-unlink" ng-class="store.isDisconnecting?'fa-spin':''" aria-hidden="true"></span> Disconnect
							</button>
						</span>
						<span class="pull-left top-half-gutter" ng-show="store.hasConnectionAttempt()">
							<div class="h4 text-uppercase" ng-switch="store.userStore().status()" ng-if="store.userStore().status() !== 'Ready'">
								{{store.userStore().status()}}
								<span class="fa fa-share text-success" ng-switch-when="Connecting" aria-hidden="true"></span>
								<span class="fa fa-times text-danger" ng-switch-when="Invalid Credentials" aria-hidden="true"></span>
								<span class="fa fa-shopping-cart fa-pulse" ng-switch-when="Purchase Review" aria-hidden="true"></span>
							</div>
							<div class="small" ng-if="store.userStore().status() === 'Connecting' || store.userStore().status() === 'Purchase Review'">
								Check back in a bit, or refresh
								<button type="button" title="refresh" class="btn btn-default btn-flat btn-tight" ng-click="refreshUserStores()">
									<span class="fa fa-refresh" aria-hidden="true"></span>
								</button>
							</div>
						</span>

					</form>
				</div>
			</li>
		</ul>
	</div>
</div>